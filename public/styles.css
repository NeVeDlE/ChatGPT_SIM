/* ===== Theme tokens ===== */
:root{
  --bg: #080c12;
  --panel: rgba(255,255,255,0.04);
  --panel-2: rgba(255,255,255,0.06);
  --text: #e6edf3;
  --text-dim: #9fb0c0;
  --muted: #7a8a98;
  --border: rgba(255,255,255,0.12);

  --accent-1: #7c3aed; /* violet */
  --accent-2: #06b6d4; /* cyan */
  --accent-3: #22c55e; /* green */

  --shadow: 0 12px 30px rgba(0,0,0,0.45);
  --r-xl: 18px;
  --r-lg: 14px;
  --r-md: 12px;

  --pad: 14px;
  --focus: 0 0 0 3px rgba(124,58,237,.45);
}

/* Encourage dark popups for form controls where supported */
:root { color-scheme: dark; }

/* Light scheme option */
@media (prefers-color-scheme: light){
  :root{
    --bg: #f7f8fb;
    --panel: rgba(10,12,15,0.03);
    --panel-2: rgba(10,12,15,0.06);
    --text: #0f1720;
    --text-dim: #475569;
    --muted: #5b6572;
    --border: rgba(0,0,0,0.12);
    --shadow: 0 10px 24px rgba(0,0,0,0.08);
  }
}

/* ===== Base ===== */
*{ box-sizing:border-box }
html,body{ height:100% }
body{
  margin:0;
  background:
    radial-gradient(1200px 700px at 0% -20%, rgba(124,58,237,0.24), transparent 60%),
    radial-gradient(900px 500px at 100% 0%, rgba(6,182,212,0.18), transparent 60%),
    var(--bg);
  color:var(--text);
  font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

a.link{ color:#a5b4fc; text-decoration:none }
a.link:hover{ text-decoration:underline }

.card{
  background:linear-gradient(180deg, var(--panel), rgba(255,255,255,0.02));
  border:1px solid var(--border);
  border-radius:var(--r-xl);
  box-shadow:var(--shadow);
  backdrop-filter:blur(10px);
}

.gradient-text{
  background:linear-gradient(90deg, #c4b5fd, #67e8f9, #34d399);
  -webkit-background-clip:text; background-clip:text; color:transparent;
}

/* ===== Auth pages ===== */
.auth-bg{ display:grid; place-items:center; min-height:100dvh; }
.auth-wrap{ width:min(720px, 94vw); }
.auth-card{ padding:28px; }
.auth-brand{ display:flex; align-items:center; gap:12px; margin-bottom:16px; }
.gem{
  width:36px; height:36px; border-radius:10px;
  background:conic-gradient(from 180deg at 50% 50%, var(--accent-1), var(--accent-2), var(--accent-3), var(--accent-1));
  box-shadow:inset 0 0 12px rgba(0,0,0,0.25);
}
.auth-brand h1{ margin:0; font-size:18px; font-weight:700 }
.auth-brand .sub{ margin:0; color:var(--text-dim) }

.form{ display:grid; gap:14px; }
.field-set{ display:grid; gap:6px; }
.label{ font-size:13px; color:var(--text-dim); }
.input-text{
  width:100%; padding:12px 14px; border-radius:12px;
  background:var(--panel-2); color:var(--text);
  border:1px solid var(--border); outline:none;
}
.input-text:focus{ box-shadow: var(--focus); border-color: transparent; }

.checkbox{ display:flex; align-items:center; gap:8px; color:var(--text-dim); font-size:14px; }
.row{ display:flex; gap:12px; align-items:center; }
.row.between{ justify-content:space-between; }
.row.center{ justify-content:center; }

.btn{
  display:inline-flex; align-items:center; justify-content:center; gap:8px;
  padding:10px 12px; border-radius:12px; font-weight:600; cursor:pointer;
  color:var(--text); background:linear-gradient(180deg, rgba(255,255,255,0.07), rgba(255,255,255,0.03));
  border:1px solid var(--border);
}
.btn:focus{ box-shadow: var(--focus) }
.btn.full{ width:100% }
.btn-primary{ background:linear-gradient(90deg, var(--accent-1), var(--accent-2), var(--accent-3)); border:none }

.form-hint{ margin:4px 0 0; color:var(--text-dim); font-size:12px; }

.auth-footer{ margin-top:12px; text-align:center; color:var(--text-dim) }

/* ===== App layout ===== */
.app{
  display:grid;
  grid-template-columns:300px 1fr;
  grid-template-rows:64px 1fr 92px;
  grid-template-areas:
    "sidebar header"
    "sidebar chat"
    "sidebar composer";
  gap:var(--pad);
  height:100dvh;
  padding:var(--pad);
}

/* ===== Sidebar ===== */
.sidebar{ grid-area:sidebar; display:flex; flex-direction:column; overflow:hidden; min-height:0; }
.brand{ display:flex; align-items:center; gap:12px; padding:16px 16px 10px; }
.brand-text h1{ margin:0; font-size:16px; font-weight:700; letter-spacing:.2px }
.brand-text .sub{ margin:.5px 0 0; color:var(--text-dim); font-size:12px }

.side-actions{ display:flex; gap:8px; padding:6px 16px 12px; }
.threads{
  padding:6px 8px 12px;
  overflow-y:auto;           /* vertical only */
  overflow-x:hidden;         /* remove horizontal bar */
  min-height:0;
  flex:1;                    /* take remaining space above account */
}
.divider{ height:1px; background:var(--border); margin:6px 16px; opacity:.5 }

.thread{
  display:flex; align-items:center; gap:10px;
  width:100%;
  padding:10px 10px; margin:6px 6px;
  border-radius:12px; border:1px solid transparent;
  color:var(--text-dim); background:transparent; text-align:left; cursor:pointer;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.thread:hover{ background:var(--panel-2); border-color:var(--border); color:var(--text) }
.dot{ width:8px; height:8px; border-radius:50%; background:linear-gradient(180deg, var(--accent-1), var(--accent-2)); box-shadow:0 0 8px rgba(124,58,237,.6) }

/* Full-width account area (fills bottom like ChatGPT) */
.account{
  position:sticky; bottom:14px;
  margin: 6px 14px 14px;
  padding:10px 12px;
  border-radius:16px;
  border:1px solid var(--border);
  background:linear-gradient(180deg, var(--panel-2), rgba(255,255,255,0.02));
  display:flex; align-items:center; gap:10px;
  box-shadow: var(--shadow);
}
.acc-avatar{
  width:36px; height:36px; border-radius:50%; display:grid; place-items:center;
  background:linear-gradient(180deg, rgba(124,58,237,.35), rgba(6,182,212,.25));
  color:#f1f5f9; font-weight:800;
}
.acc-meta{ line-height:1.1; overflow:hidden; }
.acc-name{ font-size:13px; white-space:nowrap; text-overflow:ellipsis; overflow:hidden; display:block; }
.acc-sub{ font-size:11px; color:var(--text-dim); white-space:nowrap; text-overflow:ellipsis; overflow:hidden; display:block; }

/* ===== Header ===== */
.header{
  grid-area:header; display:flex; align-items:center; justify-content:space-between; padding:0 14px;
}
.status{
  display:inline-flex; align-items:center; gap:8px; font-size:13px; color:var(--text-dim);
  border:1px solid var(--border); border-radius:999px; padding:8px 10px; background:var(--panel);
}
.pulse{
  width:10px; height:10px; border-radius:50%; background:var(--accent-3);
  box-shadow:0 0 0 0 rgba(34,197,94,.55);
  animation:pulse 1.8s infinite;
}
@keyframes pulse{
  0%{ box-shadow:0 0 0 0 rgba(34,197,94,.55) }
  70%{ box-shadow:0 0 0 12px rgba(34,197,94,0) }
  100%{ box-shadow:0 0 0 0 rgba(34,197,94,0) }
}

/* ===== Dark custom select (no white) ===== */
.select-wrap{ position:relative; display:inline-block; }
.select{
  appearance:none; -webkit-appearance:none; -moz-appearance:none;
  background:var(--panel);
  color:var(--text);
  border:1px solid var(--border);
  padding:10px 36px 10px 12px;
  border-radius:12px;
  font-weight:600; outline:none;
}
.select:focus{ box-shadow: var(--focus); border-color:transparent; }
.select-caret{
  position:absolute; right:10px; top:0; bottom:0; margin:auto; width:12px; height:12px;
  pointer-events:none;
  background:
    linear-gradient(45deg, transparent 45%, var(--text) 46%) left bottom,
    linear-gradient(-45deg, transparent 45%, var(--text) 46%) right bottom;
  background-size: 50% 50%; background-repeat:no-repeat; transform: translateY(2px);
}
/* Darken option rows where supported */
.select option{ background:#0d131a; color:var(--text); }

/* ===== Chat area ===== */
.chat{
  grid-area:chat; padding:18px; overflow:auto; display:flex; flex-direction:column; gap:14px;
}
.msg{ display:grid; grid-template-columns:38px 1fr; gap:12px; align-items:flex-start; }
.avatar{
  width:38px; height:38px; border-radius:12px; display:grid; place-items:center;
  background:var(--panel-2); border:1px solid var(--border); color:#cbd5e1; font-weight:800;
}
.avatar.user{ background:linear-gradient(180deg, rgba(34,197,94,.35), rgba(255,255,255,.06)); color:#d1fae5; }

.bubble{
  padding:14px 16px; border-radius:16px; border:1px solid var(--border);
  background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
}
.bubble.assistant{
  background:
    linear-gradient(180deg, rgba(124,58,237,0.10), rgba(6,182,212,0.10)),
    linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
}
.meta{ display:flex; gap:12px; align-items:center; margin-bottom:6px; color:var(--muted); font-size:12px; }
.role{ font-weight:700; color:#c7d2fe; }
.role.you{ color:#a7f3d0; }
.time{ color:var(--text-dim); }

pre.code{
  margin:10px 0 0; background:#0a0f14; border:1px solid var(--border);
  border-radius:12px; padding:12px; overflow:auto;
}
pre.code code{
  font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  font-size:13px; color:#d1e7ff;
}

/* ===== Composer ===== */
.composer{
  grid-area:composer; display:grid; grid-template-columns:1fr auto; gap:var(--pad);
}
.input{
  display:flex; align-items:flex-end; gap:10px; padding:12px; border-radius:16px;
  background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  border:1px solid var(--border);
}
.field{
  width:100%; resize:none; max-height:160px; min-height:42px;
  background:transparent; border:none; outline:none; color:var(--text); font:inherit; line-height:1.45;
}
.icon-btn{
  border:none; outline:none; cursor:pointer; background:var(--panel);
  border:1px solid var(--border); color:var(--text); width:40px; height:40px; border-radius:10px; display:grid; place-items:center;
}
.send{
  background:linear-gradient(90deg, var(--accent-1), var(--accent-2), var(--accent-3));
  border:none; color:white; font-weight:800; padding:0 18px; border-radius:12px; cursor:pointer; letter-spacing:.4px;
}

/* ===== Scrollbars (dark) ===== */
::-webkit-scrollbar{ width:10px; height:10px }
::-webkit-scrollbar-thumb{
  background: rgba(255,255,255,0.12);
  border-radius:12px;
  border: 2px solid transparent;
  background-clip: padding-box;
}
::-webkit-scrollbar-thumb:hover{ background: rgba(255,255,255,0.20); }
::-webkit-scrollbar-track{ background: rgba(0,0,0,0.25); border-radius:12px }

/* Firefox */
*{ scrollbar-width: thin; scrollbar-color: rgba(255,255,255,0.18) rgba(0,0,0,0.25); }

/* ===== Accessibility ===== */
.sr-only{
  position:absolute !important; width:1px !important; height:1px !important;
  padding:0 !important; margin:-1px !important; overflow:hidden !important;
  clip:rect(0,0,0,0) !important; white-space:nowrap !important; border:0 !important;
}

/* ===== Responsive ===== */
@media (max-width:980px){
  .app{
    grid-template-columns:1fr;
    grid-template-rows:56px 1fr 92px 280px;
    grid-template-areas:
      "header"
      "chat"
      "composer"
      "sidebar";
  }
}
.msg {
  display: grid;
  grid-template-columns: 38px 1fr;
  gap: 8px;
  align-items: flex-start;
  margin: 6px 0; /* less spacing between messages */
}

.bubble {
  padding: 8px 12px; /* reduced padding */
  border-radius: 12px;
  border: 1px solid var(--border);
  background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  max-width: 80%; /* don't stretch full width */
  word-wrap: break-word;
  white-space: pre-wrap; /* handle short messages without stretching */
}

.msg.user {
  grid-template-columns: 1fr 38px; /* flip */
  text-align: right;
}

.msg.user .bubble {
  justify-self: end; /* push bubble to the right */
}
/* —— Streaming UI bits —— */
.bubble.streaming { position: relative; }
.cursor {
    display:inline-block; width:10px; height:1em; margin-left:2px;
    background: currentColor; opacity:.75; vertical-align: -2px;
    animation: cursor-blink 1s steps(1) infinite;
}
@keyframes cursor-blink { 0%, 49% {opacity:.75} 50%, 100% {opacity:0} }

.typing {
    display:inline-flex; gap:6px; align-items:center; margin-left:6px; opacity:.75;
}
.typing span {
    width:6px; height:6px; border-radius:50%; background: currentColor;
    animation: typing-bounce 1s infinite ease-in-out;
}
.typing span:nth-child(2){ animation-delay:.12s }
.typing span:nth-child(3){ animation-delay:.24s }
@keyframes typing-bounce {
    0%, 80%, 100% { transform: translateY(0) }
    40% { transform: translateY(-4px) }
}

/* Optional: only auto-scroll if near bottom */
.chat.scrolling-soft { scroll-behavior: auto; }
/* —— Message actions (icons + tooltips) —— */
.msg-actions{
    display:flex; gap:8px; margin:6px 0 0; flex-wrap:wrap; opacity:.96;
}
.msg.assistant .msg-actions{ justify-content:flex-start }
.msg.user .msg-actions{ justify-content:flex-end }

.msg-action{
    position:relative;
    appearance:none; border:none; cursor:pointer;
    width:34px; height:34px; border-radius:10px;
    display:grid; place-items:center;
    color:var(--text);
    background:var(--panel);
    border:1px solid var(--border);
}
.msg-action:hover{ background:var(--panel-2) }
.msg-action:focus{ outline:none; box-shadow: var(--focus) }
.msg-action svg{ width:16px; height:16px; fill:currentColor; }

/* Active state (e.g. reading) */
.msg-action.is-active{
    box-shadow: 0 0 0 2px rgba(34,197,94,.35), var(--focus);
    border-color: rgba(34,197,94,.55);
}

/* Tooltips */
.msg-action[data-tip]::after{
    content: attr(data-tip);
    position:absolute; left:50%; bottom:calc(100% + 8px);
    transform: translateX(-50%) translateY(4px);
    white-space:nowrap;
    background:#0b1117; color:#e2e8f0; border:1px solid var(--border);
    padding:6px 8px; border-radius:8px; font-size:12px;
    opacity:0; pointer-events:none; transition: all .15s ease;
    box-shadow: var(--shadow);
    z-index: 10;
}
.msg-action[data-tip]:hover::after,
.msg-action[data-tip]:focus-visible::after{
    opacity:1; transform: translateX(-50%) translateY(0);
}
.variant-hidden{display:none}
.variant-nav{display:inline-flex;gap:6px;align-items:center;margin-right:auto}
.variant-btn{appearance:none;border:1px solid var(--border);background:var(--panel);color:var(--text);width:30px;height:30px;border-radius:8px;display:grid;place-items:center}
.variant-btn:hover{background:var(--panel-2)}
.variant-count{font-size:12px;color:var(--text-dim)}
/* Smooth container scrolling by default */
.chat { scroll-behavior: smooth; }

/* Animate message visibility changes (used when we toggle .variant-hidden) */
.msg {
    transition:
            opacity .18s ease,
            transform .18s ease,
            max-height .22s ease,
            margin .22s ease,
            padding .22s ease;
    will-change: opacity, transform;
}

/* Hidden state that still animates (no display:none!) */
.msg.variant-hidden {
    opacity: 0;
    transform: translateY(8px);
    max-height: 0;
    margin-top: 0 !important;
    margin-bottom: 0 !important;
    padding-top: 0 !important;
    padding-bottom: 0 !important;
    overflow: hidden;
    pointer-events: none;
}

/* Subtle enter animation whenever a message is appended */
.msg.msg-enter {
    opacity: 0;
    transform: translateY(8px);
}
.msg.msg-enter.msg-enter-active {
    opacity: 1;
    transform: none;
    transition: opacity .18s ease, transform .18s ease;
}

/* Respect users who prefer reduced motion */
@media (prefers-reduced-motion: reduce) {
    .chat { scroll-behavior: auto; }
    .msg { transition: none !important; }
    .msg.variant-hidden { transform: none; }
}
/* Wrapper that holds the bubble + actions; width fits content */
.msg-stack{
    display: inline-flex;
    flex-direction: column;
    gap: 6px;
    max-width: 80%;          /* cap the whole block (used to be on .bubble) */
}

/* Place the whole block left for assistant, right for user */
.msg.assistant .msg-stack{ justify-self: start; }
.msg.user .msg-stack{ justify-self: end; }

/* Actions should not stretch to full 1fr column */
.msg-stack .msg-actions{
    align-self: stretch;      /* same width as .msg-stack (i.e., the bubble) */
    width: auto;              /* don’t force 100% of grid column */
    justify-content: flex-start;
}

/* For user messages, keep actions aligned under the right edge */
.msg.user .msg-stack .msg-actions{ justify-content: flex-end; }

/* Optional: now that the cap moved to the wrapper, let bubble fill it */
.bubble{ max-width: 100%; }   /* <— add this if you remove max-width from .bubble */


